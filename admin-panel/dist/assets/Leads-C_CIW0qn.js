import{u as ae,d as re,r as a,a6 as f,a7 as Q,a8 as D,z as o,j as e,m as b,U as ie,p as L,s as x,X as le,L as oe,B as ne,a9 as ce}from"./index-DpfGS3Ht.js";import{T as de}from"./Table-FvLzyYkS.js";import{u as P,w as ue,b as me,B as xe}from"./xlsx-BVpTWNsS.js";import{S as pe}from"./SearchInput-CP9JsF7u.js";import{P as he}from"./Pagination-DItAE_xV.js";import{L as ge,a as ye}from"./LeadDetailModal-Dveq0y_6.js";import{C as je,L as fe}from"./LeadStatusBadge-uRWzzBTQ.js";import{C as be}from"./circle-check-big-BLLBtyX0.js";import{F as ve}from"./filter-Ck4y10I1.js";import{E as O}from"./eye-B8aLYjqH.js";import{M as Ne}from"./mail-C_Wl97J7.js";import"./Modal-9Na5SDL_.js";import"./trash-2-Cjm8fSoJ.js";import"./download-B7t1c9JD.js";import"./trending-up-9sMzrTP7.js";import"./dollar-sign-BE4S_9FW.js";import"./calendar-6our05Fb.js";import"./phone-call-u8pH4PaT.js";import"./save-BcRJrSrN.js";const Oe=()=>{const i=ae(),{leads:F,loading:H,pagination:w,stats:p}=re(t=>t.leads),[h,B]=a.useState(""),[g,A]=a.useState(""),[y,E]=a.useState(""),[j,z]=a.useState(""),[n,C]=a.useState({start:"",end:""}),[V,$]=a.useState(null),[J,M]=a.useState(!1),[d,T]=a.useState(1),[I,W]=a.useState(!1),[l,k]=a.useState([]),[we,v]=a.useState(!1),u=20;a.useEffect(()=>{const t={};g&&(t.status=g),y&&(t.priority=y),j&&(t.businessType=j),n.start&&(t.startDate=n.start),n.end&&(t.endDate=n.end),h&&(t.search=h),t.page=d,t.limit=u,i(f(t))},[i,g,y,j,n,h,d]),a.useEffect(()=>{i(Q())},[i]);const U=t=>{$(t),i(ce(t)),M(!0)},X=async t=>{try{await i(D({id:t,data:{status:"contacted",contactedAt:new Date().toISOString()}})).unwrap(),o.success("Lead marked as contacted"),i(f({page:d,limit:u}))}catch{o.error("Failed to mark as contacted")}},q=()=>{A(""),E(""),z(""),C({start:"",end:""}),B(""),T(1)},G=a.useCallback((t,r)=>{k(t)},[]),K=a.useCallback(async t=>{if(l.length!==0){v(!0);try{let r=0,c=0;for(const s of l)try{await i(D({id:s._id,data:{status:t}})).unwrap(),r++}catch{c++}r>0&&o.success(`Successfully updated ${r} lead(s) to ${t}`),c>0&&o.error(`Failed to update ${c} lead(s)`),k([]),i(f({page:d,limit:u}))}catch{o.error("Bulk status update failed")}finally{v(!1)}}},[l,i,d,u]),Y=a.useCallback(async t=>{if(l.length!==0){v(!0);try{let r=0,c=0;for(const s of l)try{await i(D({id:s._id,data:{priority:t}})).unwrap(),r++}catch{c++}r>0&&o.success(`Successfully updated ${r} lead(s) priority to ${t}`),c>0&&o.error(`Failed to update ${c} lead(s)`),k([]),i(f({page:d,limit:u}))}catch{o.error("Bulk priority update failed")}finally{v(!1)}}},[l,i,d,u]),Z=a.useCallback(()=>{if(l.length===0){o.error("No leads selected");return}try{const t=l.map(s=>({"Lead ID":s._id,"Buyer Name":s.buyerName||"N/A",Email:s.buyerEmail||"N/A",Phone:s.buyerPhone||"N/A",Company:s.companyName||"N/A","Business Type":s.businessType||"N/A",Product:s.productName||"N/A",Quantity:s.quantityRequired||0,Status:s.status||"N/A",Priority:s.priority||"N/A","Quoted Price":s.quotedPrice||"N/A","Follow-up Date":s.followUpDate?new Date(s.followUpDate).toLocaleDateString():"N/A","Created At":s.createdAt?new Date(s.createdAt).toLocaleDateString():"N/A"})),r=P.json_to_sheet(t),c=P.book_new();P.book_append_sheet(c,r,"Leads"),ue(c,`leads-export-${Date.now()}.xlsx`),o.success(`Exported ${l.length} lead(s) to Excel`)}catch(t){console.error("Export error:",t),o.error("Failed to export leads")}},[l]),_=a.useCallback(()=>{if(l.length===0){o.error("No leads selected");return}try{me(l),o.success(`Exported ${l.length} lead(s) to PDF`)}catch(t){console.error("PDF export error:",t),o.error("Failed to export leads to PDF")}},[l]),ee=t=>new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),te=t=>{const r=new Date(t),s=new Date-r,m=Math.floor(s/6e4),S=Math.floor(s/36e5),R=Math.floor(s/864e5);return m<1?"Just now":m<60?`${m} min${m>1?"s":""} ago`:S<24?`${S} hour${S>1?"s":""} ago`:`${R} day${R>1?"s":""} ago`},se=[{key:"createdAt",label:"Date/Time",render:t=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:te(t.createdAt)}),e.jsx("div",{className:"text-xs text-gray-500",children:ee(t.createdAt)})]})},{key:"buyerName",label:"Buyer",render:t=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:t.buyerName}),t.companyName&&e.jsx("div",{className:"text-xs text-gray-600",children:t.companyName}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:t.businessType})]})},{key:"contact",label:"Contact",render:t=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(L,{size:12}),e.jsx("span",{children:t.buyerPhone})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600 text-xs",children:[e.jsx(Ne,{size:12}),e.jsx("span",{className:"truncate max-w-[150px]",title:t.buyerEmail,children:t.buyerEmail})]})]})},{key:"product",label:"Product",render:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[t.productId?.image&&e.jsx("img",{src:t.productId.image,alt:t.productName,className:"w-10 h-10 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate max-w-[200px]",title:t.productName,children:t.productName}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Qty: ",t.quantityRequired]})]})]})},{key:"status",label:"Status",render:t=>e.jsx(fe,{status:t.status})},{key:"priority",label:"Priority",render:t=>e.jsx(ye,{priority:t.priority})},{key:"actions",label:"Actions",render:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"primary",size:"small",onClick:()=>U(t),children:e.jsx(O,{size:16})}),t.status==="new"&&e.jsx(x,{variant:"success",size:"small",onClick:()=>X(t._id),title:"Mark as Contacted",children:e.jsx(L,{size:16})})]})}],N=[g,y,j,n.start,n.end,h].filter(Boolean).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"B2B Leads"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage buyer inquiries and business leads"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Leads"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:p.totalLeads||0})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(ie,{className:"text-blue-600",size:24})})]})}),e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"New Leads"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:p.statusCounts?.new||0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last 7 days: ",p.newLeadsLast7Days||0]})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(je,{className:"text-red-600",size:24})})]})}),e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contacted"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 mt-2",children:p.statusCounts?.contacted||0})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:e.jsx(L,{className:"text-yellow-600",size:24})})]})}),e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Closed Deals"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:p.statusCounts?.closed||0})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(be,{className:"text-green-600",size:24})})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(pe,{value:h,onChange:B,placeholder:"Search by buyer name, email, phone, company..."})}),e.jsxs(x,{variant:"outline",onClick:()=>W(!I),children:[e.jsx(ve,{size:18}),"Filters ",N>0&&`(${N})`]})]}),I&&e.jsxs(b.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:g,onChange:t=>A(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"contacted",children:"Contacted"}),e.jsx("option",{value:"interested",children:"Interested"}),e.jsx("option",{value:"quoted",children:"Quoted"}),e.jsx("option",{value:"negotiating",children:"Negotiating"}),e.jsx("option",{value:"closed",children:"Closed"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"lost",children:"Lost"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("select",{value:y,onChange:t=>E(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Priority"}),e.jsx("option",{value:"urgent",children:"Urgent"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),e.jsxs("select",{value:j,onChange:t=>z(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"retailer",children:"Retailer"}),e.jsx("option",{value:"wholesaler",children:"Wholesaler"}),e.jsx("option",{value:"distributor",children:"Distributor"}),e.jsx("option",{value:"manufacturer",children:"Manufacturer"}),e.jsx("option",{value:"business_customer",children:"Business Customer"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:n.start,onChange:t=>C({...n,start:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:n.end,onChange:t=>C({...n,end:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),N>0&&e.jsx("div",{className:"flex items-end",children:e.jsxs(x,{variant:"outline",onClick:q,className:"w-full",children:[e.jsx(le,{size:18}),"Clear Filters"]})})]})]}),e.jsx(xe,{selectedCount:l.length,onBulkStatusUpdate:K,onBulkExport:Z,onBulkExportPDF:_,showDelete:!1,showStatusUpdate:!0,showExport:!0,showExportPDF:!0,showAssign:!1,availableStatuses:[{value:"new",label:"New"},{value:"contacted",label:"Contacted"},{value:"interested",label:"Interested"},{value:"quoted",label:"Quoted"},{value:"negotiating",label:"Negotiating"},{value:"closed",label:"Closed"},{value:"lost",label:"Lost"}],customActions:[{label:"Update Priority",variant:"secondary",onClick:()=>{const t=prompt("Enter priority (low, medium, high, urgent):");t&&["low","medium","high","urgent"].includes(t.toLowerCase())&&Y(t.toLowerCase())}}]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200",children:H?e.jsx(oe,{}):F.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ne,{className:"mx-auto text-gray-400 mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"No leads found"}),N>0&&e.jsx(x,{variant:"outline",onClick:q,className:"mt-4",children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{columns:se,data:F,enableBulkSelection:!0,onSelectionChange:G,getRowId:t=>t._id,actions:t=>e.jsx(x,{size:"sm",variant:"outline",onClick:()=>U(t),icon:e.jsx(O,{size:16}),children:"View"})}),w.pages>1&&e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsx(he,{currentPage:d,totalPages:w.pages,onPageChange:T,itemsPerPage:u,totalItems:w.total})})]})}),e.jsx(ge,{isOpen:J,onClose:()=>{M(!1),$(null)},lead:V,onUpdate:()=>{i(f({page:d,limit:u})),i(Q())}})]})};export{Oe as default};
