import{a5 as h,r as i,j as e,s as j,m as z,X as f,L as E,a as w,z as y}from"./index-DrVHF49k.js";import{T as Q}from"./Table-CPTOpXxD.js";import{S as A}from"./SearchInput-DQh0A_yT.js";import{P as H}from"./Pagination-hbdeIJ1d.js";import{E as $}from"./eye-BUrtzTko.js";import{F as I}from"./filter-DjuklAPT.js";const S={getAll:async(o={})=>(await h.get("/bulk-rfqs",{params:o})).data,getById:async o=>(await h.get(`/bulk-rfqs/${o}`)).data,update:async(o,a)=>(await h.put(`/bulk-rfqs/${o}`,a)).data},C=[{value:"",label:"All"},{value:"new",label:"New"},{value:"in_progress",label:"In Progress"},{value:"quoted",label:"Quoted"},{value:"won",label:"Won"},{value:"lost",label:"Lost"},{value:"closed",label:"Closed"}],T=o=>{const a=w.c(5),{status:s}=o,m={new:"bg-blue-50 text-blue-700 border-blue-200",in_progress:"bg-amber-50 text-amber-700 border-amber-200",quoted:"bg-purple-50 text-purple-700 border-purple-200",won:"bg-green-50 text-green-700 border-green-200",lost:"bg-red-50 text-red-700 border-red-200",closed:"bg-gray-50 text-gray-700 border-gray-200"},c=`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold border ${m[s]||m.closed}`,n=String(s||"closed");let r;a[0]!==n?(r=n.replace("_"," "),a[0]=n,a[1]=r):r=a[1];let d;return a[2]!==c||a[3]!==r?(d=e.jsx("span",{className:c,children:r}),a[2]=c,a[3]=r,a[4]=d):d=a[4],d},L=o=>{const a=w.c(3),{priority:s}=o,m={low:"bg-gray-50 text-gray-700 border-gray-200",medium:"bg-amber-50 text-amber-700 border-amber-200",high:"bg-red-50 text-red-700 border-red-200"},c=`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold border ${m[s]||m.low}`,n=s||"low";let r;return a[0]!==c||a[1]!==n?(r=e.jsx("span",{className:c,children:n}),a[0]=c,a[1]=n,a[2]=r):r=a[2],r},_=({open:o,onClose:a,rfq:s,onUpdated:m})=>{const[x,c]=i.useState(s?.status||"new"),[n,r]=i.useState(s?.adminNotes||""),[d,u]=i.useState(!1);if(i.useEffect(()=>{c(s?.status||"new"),r(s?.adminNotes||"")},[s]),!o||!s)return null;const p=async()=>{u(!0);try{await S.update(s._id,{status:x,adminNotes:n}),y.success("Bulk RFQ updated"),m?.(),a()}catch{y.error("Failed to update Bulk RFQ")}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold",children:"Bulk RFQ"}),e.jsx("div",{className:"text-sm text-gray-500",children:s._id})]}),e.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100",onClick:a,children:e.jsx(f,{size:18})})]}),e.jsxs("div",{className:"p-5 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-3",children:"Buyer"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",s.buyerName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.buyerEmail]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.buyerPhone]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"City:"})," ",s.buyerCity]}),s.companyName&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Company:"})," ",s.companyName]}),s.gstNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"GST:"})," ",s.gstNumber]})]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-3",children:"Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("select",{value:x,onChange:l=>c(l.target.value),className:"w-full px-3 py-2 rounded-lg border",children:C.filter(l=>l.value).map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("textarea",{value:n,onChange:l=>r(l.target.value),rows:5,className:"w-full px-3 py-2 rounded-lg border",placeholder:"Admin notes"}),e.jsx(j,{onClick:p,disabled:d,className:"w-full",children:d?"Saving...":"Save"})]})]}),e.jsxs("div",{className:"md:col-span-2 rounded-xl border p-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-3",children:"Items"}),e.jsx("div",{className:"divide-y",children:(s.items||[]).map((l,g)=>e.jsxs("div",{className:"py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-800 line-clamp-1",children:l.productName}),e.jsxs("div",{className:"text-xs text-gray-500",children:[l.size?`Size: ${l.size}`:"",l.size&&l.color?" â€¢ ":"",l.color?`Color: ${l.color}`:""]})]}),e.jsxs("div",{className:"text-sm font-semibold text-gray-800",children:["Qty: ",l.quantityRequired]})]},g))})]}),s.requirements&&e.jsxs("div",{className:"md:col-span-2 rounded-xl border p-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Requirements"}),e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:s.requirements})]})]})]})})},X=()=>{const[o,a]=i.useState(!0),[s,m]=i.useState([]),[x,c]=i.useState({page:1,limit:20,total:0,pages:1}),[n,r]=i.useState(""),[d,u]=i.useState(""),[p,l]=i.useState(1),[g,k]=i.useState(null),[F,v]=i.useState(!1),B=i.useMemo(()=>[{Header:"RFQ ID",accessor:"_id"},{Header:"Buyer",accessor:"buyerName"},{Header:"Email",accessor:"buyerEmail"},{Header:"Items",accessor:"items",Cell:({value:t})=>e.jsx("span",{className:"font-semibold",children:Array.isArray(t)?t.length:0})},{Header:"Status",accessor:"status",Cell:({value:t})=>e.jsx(T,{status:t})},{Header:"Priority",accessor:"priority",Cell:({value:t})=>e.jsx(L,{priority:t})},{Header:"Created",accessor:"createdAt",Cell:({value:t})=>t?new Date(t).toLocaleString():"-"},{Header:"Actions",accessor:"actions",Cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>{k(t.original),v(!0)},children:e.jsx($,{size:16})})})}],[]),b=async()=>{a(!0);try{const t={page:p,limit:x.limit};d&&(t.status=d),n&&(t.q=n);const N=await S.getAll(t);m(N?.data||[]),c(N?.pagination||{page:1,limit:20,total:0,pages:1})}catch{y.error("Failed to load Bulk RFQs"),m([]),c({page:1,limit:20,total:0,pages:1})}finally{a(!1)}};i.useEffect(()=>{b()},[p,d]);const P=()=>{u(""),r(""),l(1)},R=()=>{l(1),b()};return e.jsxs("div",{className:"p-6",children:[e.jsxs(z.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Bulk RFQs"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Multi-item inquiries submitted from the B2B Shop."})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3 justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-3",children:[e.jsx(A,{value:n,onChange:t=>r(t.target.value),placeholder:"Search by buyer, email, company, product",onSearch:R}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{size:18,className:"text-gray-500"}),e.jsx("select",{value:d,onChange:t=>{u(t.target.value),l(1)},className:"px-3 py-2 rounded-lg border border-gray-200",children:C.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(j,{variant:"secondary",onClick:P,children:[e.jsx(f,{size:16,className:"mr-2"}),"Clear"]})})]})}),o?e.jsx(E,{}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{columns:B,data:s}),e.jsx("div",{className:"mt-4",children:e.jsx(H,{currentPage:x.page,totalPages:x.pages,onPageChange:t=>l(t)})})]}),e.jsx(_,{open:F,onClose:()=>v(!1),rfq:g,onUpdated:b})]})};export{X as default};
