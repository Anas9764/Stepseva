import{u as L,d as T,r as m,a0 as $,j as e,L as P,s as d,a1 as E,a2 as S,z as p,a3 as k,a4 as V}from"./index-DpfGS3Ht.js";import{u as M,o as q,c as z,b as U,e as x,f as O,a as f}from"./index.esm-CuvX_hxC.js";import{T as F}from"./Table-FvLzyYkS.js";import{M as R}from"./Modal-9Na5SDL_.js";import{P as I}from"./plus-H8rF0gv1.js";import{P as B}from"./pen-BJKIaCD2.js";import{T as Z}from"./trash-2-Cjm8fSoJ.js";const G=z().shape({code:f().required("Coupon code is required").min(3,"Code must be at least 3 characters").matches(/^[A-Z0-9]+$/,"Code must contain only uppercase letters and numbers"),discountType:f().required("Discount type is required"),discountValue:x().positive("Discount value must be positive").required("Discount value is required"),minPurchase:x().min(0,"Minimum purchase cannot be negative"),expiryDate:O().required("Expiry date is required"),usageLimit:x().integer().min(1,"Usage limit must be at least 1"),isActive:U()}),_=()=>{const n=L(),{coupons:c,loading:g}=T(s=>s.coupons),[b,l]=m.useState(!1),[o,h]=m.useState(null),{register:r,handleSubmit:j,formState:{errors:a},reset:y,watch:v}=M({resolver:q(G)}),N=v("discountType");m.useEffect(()=>{n($())},[n]);const C=s=>{h(s),y({code:s.code,discountType:s.discountType,discountValue:s.discountValue,minPurchase:s.minPurchase||0,expiryDate:s.expiryDate?new Date(s.expiryDate).toISOString().split("T")[0]:"",usageLimit:s.usageLimit||1,isActive:s.isActive!==!1}),l(!0)},D=async s=>{window.confirm("Are you sure you want to delete this coupon?")&&(await n(S(s))).type==="coupons/delete/fulfilled"&&p.success("Coupon deleted successfully")},u=()=>{l(!1),h(null),y({code:"",discountType:"percentage",discountValue:0,minPurchase:0,expiryDate:"",usageLimit:1,isActive:!0})},w=async s=>{try{const t={...s,code:s.code.toUpperCase()};let i;o?i=await n(k({id:o._id,couponData:t})):i=await n(V(t)),i.type.includes("fulfilled")&&(p.success(o?"Coupon updated successfully":"Coupon created successfully"),u())}catch(t){console.error("Error saving coupon:",t),p.error("Failed to save coupon")}},A=[{header:"Code",accessor:"code",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:16,className:"text-lavender-500"}),e.jsx("span",{className:"font-mono font-bold text-lavender-600",children:s.code})]})},{header:"Discount",accessor:"discountValue",render:s=>s.discountType==="percentage"?`${s.discountValue}%`:`$${s.discountValue}`},{header:"Min Purchase",accessor:"minPurchase",render:s=>s.minPurchase?`$${s.minPurchase}`:"No minimum"},{header:"Usage",accessor:"usageCount",render:s=>`${s.usageCount||0} / ${s.usageLimit||"âˆž"}`},{header:"Expiry Date",accessor:"expiryDate",render:s=>new Date(s.expiryDate).toLocaleDateString()},{header:"Status",accessor:"isActive",render:s=>{const t=new Date(s.expiryDate)<new Date,i=s.usageCount>=s.usageLimit;return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.isActive&&!t&&!i?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t?"Expired":i?"Limit Reached":s.isActive?"Active":"Inactive"})}}];return g&&!c.length?e.jsx(P,{fullScreen:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Coupons"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage discount codes and promotions"})]}),e.jsx(d,{onClick:()=>l(!0),icon:e.jsx(I,{size:20}),children:"Add Coupon"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"Total Coupons"}),e.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:c.length})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"Active Coupons"}),e.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:c.filter(s=>s.isActive&&new Date(s.expiryDate)>new Date).length})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"Total Uses"}),e.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:c.reduce((s,t)=>s+(t.usageCount||0),0)})]})]}),e.jsx(F,{columns:A,data:c,actions:s=>e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>C(s),icon:e.jsx(B,{size:16}),children:"Edit"}),e.jsx(d,{size:"sm",variant:"danger",onClick:()=>D(s._id),icon:e.jsx(Z,{size:16}),children:"Delete"})]}),emptyMessage:"No coupons found"}),e.jsx(R,{isOpen:b,onClose:u,title:o?"Edit Coupon":"Add New Coupon",children:e.jsxs("form",{onSubmit:j(w),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Coupon Code *"}),e.jsx("input",{...r("code"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent uppercase font-mono",placeholder:"ECLORA10",maxLength:20}),a.code&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.code.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Use uppercase letters and numbers only"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount Type *"}),e.jsxs("select",{...r("discountType"),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"fixed",children:"Fixed Amount ($)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount Value *"}),e.jsx("input",{...r("discountValue"),type:"number",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:N==="percentage"?"10":"10.00"}),a.discountValue&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.discountValue.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Purchase ($)"}),e.jsx("input",{...r("minPurchase"),type:"number",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Usage Limit *"}),e.jsx("input",{...r("usageLimit"),type:"number",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"100"}),a.usageLimit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.usageLimit.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date *"}),e.jsx("input",{...r("expiryDate"),type:"date",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent"}),a.expiryDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.expiryDate.message})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{...r("isActive"),type:"checkbox",className:"w-4 h-4 text-lavender-600 border-gray-300 rounded focus:ring-lavender-500"}),e.jsx("label",{className:"text-sm text-gray-700",children:"Coupon is active and can be used by customers"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(d,{type:"button",variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(d,{type:"submit",loading:g,children:o?"Update Coupon":"Create Coupon"})]})]})})]})};export{_ as default};
