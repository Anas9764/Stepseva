import{u as D,d as z,r as i,Y as U,j as e,L,s as o,X as O,Z as $,z as u,_ as F,$ as M}from"./index-DrVHF49k.js";import{u as _,o as H,c as R,b as q,e as G,f as w,a as c}from"./index.esm-COT7VCDb.js";import{T as V}from"./Table-CPTOpXxD.js";import{M as X}from"./Modal-DV8JCKQd.js";import{U as Y,g as Z}from"./apiConfig-Daxc-Us_.js";import{P as J}from"./plus-DPYSK9s0.js";import{P as K}from"./pen-orpuw2s_.js";import{T as Q}from"./trash-2-C0lDSa_7.js";const W=R().shape({title:c().required("Title is required"),subtitle:c(),ctaText:c(),ctaLink:c(),placement:c(),startAt:w().nullable(),endAt:w().nullable(),priority:G().integer().min(0,"Priority must be positive"),isActive:q()}),ee=[{value:"b2b_home_hero",label:"B2B Home Hero"},{value:"b2c_home_hero",label:"B2C Home Hero"},{value:"global",label:"Global (all sites)"}],ce=()=>{const n=D(),{banners:h,loading:f}=z(t=>t.banners),[S,x]=i.useState(!1),[l,y]=i.useState(null),[j,d]=i.useState(""),[v,p]=i.useState(null),{register:a,handleSubmit:B,formState:{errors:N},reset:A}=_({resolver:H(W)});i.useEffect(()=>{n(U())},[n]);const k=t=>{y(t),A({title:t.title,subtitle:t.subtitle||"",ctaText:t.ctaText||"",ctaLink:t.ctaLink||"",placement:t.placement||"global",startAt:t.startAt?new Date(t.startAt).toISOString().slice(0,16):"",endAt:t.endAt?new Date(t.endAt).toISOString().slice(0,16):"",priority:t.priority||0,isActive:t.isActive!==!1}),d(t.image||""),x(!0)},T=async t=>{window.confirm("Are you sure you want to delete this banner?")&&(await n($(t))).type==="banners/delete/fulfilled"&&u.success("Banner deleted successfully")},g=()=>{x(!1),y(null),d(""),p(null),A()},C=t=>{const s=t.target.files[0];if(s){p(s);const r=new FileReader;r.onloadend=()=>{d(r.result)},r.readAsDataURL(s)}},I=async t=>{const s=new FormData;s.append("image",t);try{const r=Z();return(await(await fetch(`${r}/upload`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:s})).json()).imageUrl}catch(r){return console.error("Image upload failed:",r),null}},P=async t=>{try{let s=l?.image||"";if(v){const b=await I(v);if(b)s=b;else{u.error("Failed to upload image");return}}const r={...t,image:s,placement:t.placement||"global",startAt:t.startAt?new Date(t.startAt).toISOString():null,endAt:t.endAt?new Date(t.endAt).toISOString():null};let m;l?m=await n(F({id:l._id,bannerData:r})):m=await n(M(r)),m.type.includes("fulfilled")&&(u.success(l?"Banner updated successfully":"Banner created successfully"),g())}catch(s){console.error("Error saving banner:",s),u.error("Failed to save banner")}},E=[{header:"Image",accessor:"image",render:t=>e.jsx("img",{src:t.image||"/placeholder.png",alt:t.title,className:"w-32 h-20 object-cover rounded-lg"})},{header:"Title",accessor:"title"},{header:"Subtitle",accessor:"subtitle",render:t=>t.subtitle||"N/A"},{header:"CTA",accessor:"ctaText",render:t=>t.ctaText||"N/A"},{header:"Priority",accessor:"priority"},{header:"Status",accessor:"isActive",render:t=>e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.isActive?"Active":"Inactive"})}];return f&&!h.length?e.jsx(L,{fullScreen:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Banners"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage homepage banners"})]}),e.jsx(o,{onClick:()=>x(!0),icon:e.jsx(J,{size:20}),children:"Add Banner"})]}),e.jsx(V,{columns:E,data:h,actions:t=>e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>k(t),icon:e.jsx(K,{size:16}),children:"Edit"}),e.jsx(o,{size:"sm",variant:"danger",onClick:()=>T(t._id),icon:e.jsx(Q,{size:16}),children:"Delete"})]}),emptyMessage:"No banners found"}),e.jsx(X,{isOpen:S,onClose:g,title:l?"Edit Banner":"Add New Banner",size:"lg",children:e.jsxs("form",{onSubmit:B(P),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Banner Image *"}),e.jsxs("div",{className:"space-y-4",children:[j&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:j,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{d(""),p(null)},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(O,{size:16})})]}),e.jsxs("label",{className:"flex items-center justify-center gap-2 px-4 py-8 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-lavender-500 transition-colors",children:[e.jsx(Y,{size:24,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Upload Banner Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"hidden"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),e.jsx("input",{...a("title"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"Enter banner title"}),N.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subtitle"}),e.jsx("input",{...a("subtitle"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"Enter subtitle"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CTA Text"}),e.jsx("input",{...a("ctaText"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"Shop Now"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CTA Link"}),e.jsx("input",{...a("ctaLink"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"/shop"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Placement"}),e.jsx("select",{...a("placement"),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",defaultValue:"global",children:ee.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Use ",e.jsx("span",{className:"font-mono",children:"b2b_home_hero"})," for the business site carousel."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start At (optional)"}),e.jsx("input",{...a("startAt"),type:"datetime-local",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End At (optional)"}),e.jsx("input",{...a("endAt"),type:"datetime-local",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Priority"}),e.jsx("input",{...a("priority"),type:"number",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"0"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Lower numbers appear first"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{...a("isActive"),type:"checkbox",className:"w-4 h-4 text-lavender-600 border-gray-300 rounded focus:ring-lavender-500"}),e.jsx("label",{className:"text-sm text-gray-700",children:"Banner is active and visible on homepage"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:g,children:"Cancel"}),e.jsx(o,{type:"submit",loading:f,children:l?"Update Banner":"Create Banner"})]})]})})]})};export{ce as default};
