import{r,j as e,m as E,s as B,ac as P,z as p}from"./index-DrVHF49k.js";import{F as R}from"./filter-DjuklAPT.js";import{D as T}from"./download-CDHpbh-m.js";const q=()=>{const[a,g]=r.useState(""),[n,y]=r.useState(""),[i,f]=r.useState(""),[l,j]=r.useState(""),[c,b]=r.useState(""),[x,m]=r.useState(!1),v=async()=>{try{m(!0);const t={page:1,limit:1e3};a&&(t.status=a),n&&(t.priority=n),i&&(t.businessType=i),l&&(t.startDate=l),c&&(t.endDate=c);const h=await P.getAllLeads(t),d=(h?.data||h)?.leads||[];if(!d.length){p.error("No leads found for the selected filters.");return}const w=["Lead ID","Created At","Buyer Name","Email","Phone","Company","Business Type","Product","Quantity","Status","Priority","Quoted Price","Follow-up Date"],N=d.map(s=>[s._id,s.createdAt?new Date(s.createdAt).toISOString():"",s.buyerName||"",s.buyerEmail||"",s.buyerPhone||"",s.companyName||"",s.businessType||"",s.productName||"",s.quantityRequired||"",s.status||"",s.priority||"",s.quotedPrice||"",s.followUpDate?new Date(s.followUpDate).toISOString().split("T")[0]:""]),S=[w,...N].map(s=>s.map(u=>u==null?"":`"${String(u).replace(/"/g,'""')}"`).join(",")).join(`
`),D=new Blob([S],{type:"text/csv;charset=utf-8;"}),C=window.URL.createObjectURL(D),o=document.createElement("a");o.href=C,o.download=`b2b-leads-${Date.now()}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),p.success(`Exported ${d.length} leads to CSV.`)}catch(t){console.error("Error exporting leads:",t),p.error("Failed to export leads. Please try again.")}finally{m(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"B2B Reports & Export"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Export B2B leads data to CSV for offline analysis and reporting."})]})}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-gray-700",children:[e.jsx(R,{size:16}),e.jsx("span",{children:"Use filters to narrow down which leads you want to export."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:a,onChange:t=>g(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"contacted",children:"Contacted"}),e.jsx("option",{value:"interested",children:"Interested"}),e.jsx("option",{value:"quoted",children:"Quoted"}),e.jsx("option",{value:"negotiating",children:"Negotiating"}),e.jsx("option",{value:"closed",children:"Closed"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"lost",children:"Lost"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("select",{value:n,onChange:t=>y(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Priority"}),e.jsx("option",{value:"urgent",children:"Urgent"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),e.jsxs("select",{value:i,onChange:t=>f(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"retailer",children:"Retailer"}),e.jsx("option",{value:"wholesaler",children:"Wholesaler"}),e.jsx("option",{value:"distributor",children:"Distributor"}),e.jsx("option",{value:"manufacturer",children:"Manufacturer"}),e.jsx("option",{value:"business_customer",children:"Business Customer"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:l,onChange:t=>j(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:c,onChange:t=>b(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs(B,{variant:"primary",onClick:v,disabled:x,children:[e.jsx(T,{size:18}),x?"Exporting...":"Export to CSV"]})})]})]})};export{q as default};
