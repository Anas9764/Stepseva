import{u as B,d as Q,r,y as X,j as e,L as G,s as m,X as H,C as J,z as g,D as K,E as V}from"./index-DrVHF49k.js";import{u as W,o as Y,c as Z,a as E}from"./index.esm-COT7VCDb.js";import{T as ee}from"./Table-CPTOpXxD.js";import{M as se}from"./Modal-DV8JCKQd.js";import{P as ae}from"./Pagination-hbdeIJ1d.js";import{S as te}from"./SearchInput-DQh0A_yT.js";import{U as re,g as oe}from"./apiConfig-Daxc-Us_.js";import{P as ne}from"./plus-DPYSK9s0.js";import{P as le}from"./pen-orpuw2s_.js";import{T as ie}from"./trash-2-C0lDSa_7.js";const ce=Z().shape({name:E().required("Category name is required"),description:E()}),be=()=>{const i=B(),{categories:u,loading:j}=Q(s=>s.categories),[M,x]=r.useState(!1),[o,b]=r.useState(null),[C,p]=r.useState(""),[v,f]=r.useState(null),[c,z]=r.useState(""),[N,D]=r.useState(1),h=10,{register:w,handleSubmit:U,formState:{errors:P},reset:S}=W({resolver:Y(ce)});r.useEffect(()=>{i(X())},[i]);const k=s=>{b(s),S({name:s.name,description:s.description||""}),p(s.image||""),x(!0)},F=async s=>{window.confirm("Are you sure you want to delete this category?")&&(await i(J(s))).type==="categories/delete/fulfilled"&&g.success("Category deleted successfully")},y=()=>{x(!1),b(null),p(""),f(null),S()},L=s=>{const a=s.target.files[0];if(a){f(a);const t=new FileReader;t.onloadend=()=>{p(t.result)},t.readAsDataURL(a)}},A=async s=>{const a=new FormData;a.append("image",s);try{const t=oe();return(await(await fetch(`${t}/upload`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:a})).json()).imageUrl}catch(t){return console.error("Image upload failed:",t),null}},T=async s=>{try{let a=o?.image||"";if(v){const d=await A(v);if(d)a=d;else{g.error("Failed to upload image");return}}const t={...s,image:a};let l;if(o?l=await i(K({id:o._id,categoryData:t})):l=await i(V(t)),l.type.includes("fulfilled"))g.success(o?"Category updated successfully":"Category created successfully"),y();else if(l.type.includes("rejected")){const d=l.payload||"Failed to save category";g.error(d)}}catch(a){console.error("Error saving category:",a),g.error(a.message||"Failed to save category")}},n=r.useMemo(()=>c?u.filter(s=>s.name?.toLowerCase().includes(c.toLowerCase())||s.description?.toLowerCase().includes(c.toLowerCase())):u,[c,u]),O=Math.ceil(n.length/h),I=(N-1)*h,$=I+h,R=n.slice(I,$),_=s=>{D(s)},q=[{header:"Image",accessor:"image",render:s=>e.jsx("img",{src:s.image||"/placeholder.png",alt:s.name,className:"w-16 h-16 object-cover rounded-lg border border-gray-200"})},{header:"Name",accessor:"name",render:s=>e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-gray-800",children:s.name})})},{header:"Description",accessor:"description",render:s=>e.jsx("span",{className:"line-clamp-2 text-sm text-gray-600",children:s.description||"No description"})},{header:"Products",accessor:"productCount",render:s=>e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:[s.productCount||0," products"]})}];return j&&!u.length?e.jsx(G,{fullScreen:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Categories Management"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Manage product categories â€¢ ",n.length," ",n.length===1?"category":"categories"," found"]})]}),e.jsx(m,{onClick:()=>x(!0),icon:e.jsx(ne,{size:20}),children:"Add Category"})]}),e.jsx("div",{className:"w-full sm:w-96",children:e.jsx(te,{value:c,onChange:z,placeholder:"Search categories..."})}),e.jsx(ee,{columns:q,data:R,actions:s=>e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>k(s),icon:e.jsx(le,{size:16}),children:"Edit"}),e.jsx(m,{size:"sm",variant:"danger",onClick:()=>F(s._id),icon:e.jsx(ie,{size:16}),children:"Delete"})]}),emptyMessage:"No categories found"}),n.length>0&&e.jsx(ae,{currentPage:N,totalPages:O,onPageChange:_,itemsPerPage:h,totalItems:n.length,showInfo:!0,align:"right"}),e.jsx(se,{isOpen:M,onClose:y,title:o?"Edit Category":"Add New Category",children:e.jsxs("form",{onSubmit:U(T),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[C&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:C,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{p(""),f(null)},className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(H,{size:16})})]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-lavender-500 transition-colors",children:[e.jsx(re,{size:20,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:L,className:"hidden"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),e.jsx("input",{...w("name"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"Enter category name"}),P.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{...w("description"),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender-500 focus:border-transparent",placeholder:"Enter category description"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(m,{type:"button",variant:"secondary",onClick:y,children:"Cancel"}),e.jsx(m,{type:"submit",loading:j,children:o?"Update Category":"Create Category"})]})]})})]})};export{be as default};
