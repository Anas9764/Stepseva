import{r,j as e,m as l,U as u,B as g,S as y,L as N,a5 as b,ac as f}from"./index-DpfGS3Ht.js";import{T as v}from"./Table-FvLzyYkS.js";import{B as c}from"./building-2-DJ2UwetO.js";const S=()=>{const[d,o]=r.useState([]),[i,x]=r.useState([]),[m,n]=r.useState(!1);r.useEffect(()=>{(async()=>{try{n(!0);const[a,t]=await Promise.all([b.get("/business-accounts"),f.getAllLeads({limit:1e3})]);o(a.data?.data||[]);const j=t?.data||t;x(j?.leads||[])}catch(a){console.error("Error loading CRM data:",a)}finally{n(!1)}})()},[]);const h=r.useMemo(()=>{const s={};return i.forEach(a=>{if(!a.businessAccountId)return;const t=typeof a.businessAccountId=="string"?a.businessAccountId:a.businessAccountId._id;t&&(s[t]||(s[t]={totalLeads:0,openLeads:0,closedDeals:0}),s[t].totalLeads+=1,a.status==="closed"?s[t].closedDeals+=1:["rejected","lost"].includes(a.status)||(s[t].openLeads+=1))}),s},[i]),p=[{header:"Business",render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(c,{className:"text-primary",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.companyName}),e.jsx("p",{className:"text-xs text-gray-600 capitalize",children:s.businessType})]})]})},{header:"Contact",render:s=>e.jsxs("div",{className:"text-xs text-gray-700",children:[e.jsx("p",{className:"font-medium",children:s.contactPerson?.name}),e.jsx("p",{children:s.contactPerson?.email}),e.jsx("p",{children:s.contactPerson?.phone})]})},{header:"Leads / Deals",render:s=>{const a=h[s._id]||{totalLeads:0,openLeads:0,closedDeals:0};return e.jsxs("div",{className:"text-xs text-gray-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:a.totalLeads})," ","leads"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-amber-600",children:a.openLeads})," ","open"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-green-600",children:a.closedDeals})," ","closed"]})]})}},{header:"Credit",render:s=>e.jsxs("div",{className:"text-xs text-gray-700 space-y-1",children:[e.jsxs("p",{children:["Limit:"," ",e.jsxs("span",{className:"font-semibold",children:["₹",(s.creditLimit||0).toLocaleString("en-IN")]})]}),e.jsxs("p",{children:["Used:"," ",e.jsxs("span",{className:"font-semibold text-red-600",children:["₹",(s.creditUsed||0).toLocaleString("en-IN")]})]}),e.jsxs("p",{children:["Available:"," ",e.jsxs("span",{className:"font-semibold text-green-600",children:["₹",((s.creditLimit||0)-(s.creditUsed||0)).toLocaleString("en-IN")]})]})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Buyer CRM"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"See your key business customers with their lead activity and credit summary."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Business Accounts"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:d.length})]}),e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(u,{className:"text-primary",size:22})})]})}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Leads"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:i.length})]}),e.jsx("div",{className:"p-3 bg-amber-100 rounded-lg",children:e.jsx(g,{className:"text-amber-600",size:22})})]})}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Closed Deals"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:i.filter(s=>s.status==="closed").length})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(y,{className:"text-green-600",size:22})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200",children:m?e.jsx(N,{}):d.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(c,{className:"mx-auto text-gray-400 mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"No business accounts found. When customers create business accounts, they will appear here."})]}):e.jsx(v,{columns:p,data:d,emptyMessage:"No business accounts found"})})]})};export{S as default};
