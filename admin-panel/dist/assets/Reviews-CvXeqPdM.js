import{r,G as $,K as b,z as x,j as e,L,s as n,X as q,M as G}from"./index-DpfGS3Ht.js";import{T as H}from"./Table-FvLzyYkS.js";import{S as K}from"./SearchInput-CP9JsF7u.js";import{P as J}from"./Pagination-DItAE_xV.js";import{M as W}from"./Modal-9Na5SDL_.js";import{F as Y}from"./filter-Ck4y10I1.js";import{C as E}from"./circle-check-big-BLLBtyX0.js";import{C as F}from"./circle-x-DI-S7WCF.js";import{T as _}from"./trash-2-Cjm8fSoJ.js";import{E as Z}from"./eye-B8aLYjqH.js";const me=()=>{const[d,j]=r.useState([]),[w,S]=r.useState(!0),[v,y]=r.useState(null),[u,I]=r.useState(""),[g,p]=r.useState(1),[T,M]=r.useState(1),[O,C]=r.useState(0),A=10,[l,N]=r.useState({productId:"",rating:"",isApproved:""}),[R,k]=r.useState(!1),[a,h]=r.useState(null),[V,o]=r.useState(!1),{markReviewsAsSeen:B,notificationItems:Q,markAsRead:U}=$();r.useEffect(()=>{m()},[g,l]),r.useEffect(()=>{B()},[]),r.useEffect(()=>{const s=Q.filter(t=>t.type==="review"&&!t.read);s.length>0&&s.forEach(t=>U(t.id))},[]),r.useEffect(()=>{let s,t=Date.now();const i=()=>{document.visibilityState==="visible"&&Date.now()-t>18e4&&(m(),t=Date.now())},c=()=>{document.visibilityState==="visible"&&(m(),t=Date.now())};return s=setInterval(i,18e4),document.addEventListener("visibilitychange",c),()=>{clearInterval(s),document.removeEventListener("visibilitychange",c)}},[g,l]);const m=async()=>{try{S(!0),y(null);const s={page:g,limit:A,...l};Object.keys(s).forEach(i=>{(s[i]===""||s[i]===null)&&delete s[i]});const t=await b.getAllReviews(s);t.success?(j(t.data.reviews||[]),M(t.data.pagination?.pages||1),C(t.data.pagination?.total||0)):y(t.message||"Failed to fetch reviews")}catch(s){console.error("Error fetching reviews:",s),y(s.response?.data?.message||"Failed to fetch reviews"),x.error(s.response?.data?.message||"Failed to fetch reviews")}finally{S(!1)}},f=async(s,t)=>{try{await b.approveReview(s,t),x.success(`Review ${t?"approved":"rejected"} successfully`),j(i=>i.map(c=>c._id===s?{...c,isApproved:t,isActive:t}:c)),a?._id===s&&h(i=>({...i,isApproved:t,isActive:t}))}catch(i){x.error(i.response?.data?.message||"Failed to update review"),m()}},P=async s=>{if(window.confirm("Are you sure you want to delete this review?"))try{await b.deleteReview(s),x.success("Review deleted successfully"),j(t=>t.filter(i=>i._id!==s)),C(t=>Math.max(0,t-1)),a?._id===s&&(o(!1),h(null))}catch(t){x.error(t.response?.data?.message||"Failed to delete review"),m()}},z=s=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(t=>e.jsx(G,{size:16,className:t<=s?"text-yellow-400 fill-yellow-400":"text-gray-300"},t))}),D=r.useMemo(()=>{if(!u)return d;const s=u.toLowerCase();return d.filter(t=>t.user?.name?.toLowerCase().includes(s)||t.product?.name?.toLowerCase().includes(s)||t.product?._id?.toLowerCase().includes(s)||t.product?._id?.slice(-8).toLowerCase().includes(s)||t.comment?.toLowerCase().includes(s)||t.title?.toLowerCase().includes(s))},[d,u]),X=[{header:"Product",render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[s.product?.image&&e.jsx("img",{src:s.product.image,alt:s.product.name,className:"w-12 h-12 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.product?.name||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.product?._id?.slice(-8)||"N/A"]})]})]})},{header:"User",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.user?.name||"Anonymous"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.user?.email||"N/A"})]})},{header:"Rating",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[z(s.rating),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["(",s.rating,")"]})]})},{header:"Title",render:s=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.title||"No title"}),e.jsxs("div",{className:"text-sm text-gray-500 truncate",children:[s.comment?.substring(0,50),"..."]})]})},{header:"Status",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[s.isApproved?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:[e.jsx(E,{size:12}),"Approved"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium",children:[e.jsx(F,{size:12}),"Pending"]}),s.verifiedPurchase&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:"Verified"})]})},{header:"Date",render:s=>e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString()})},{header:"Actions",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"primary",size:"sm",onClick:()=>{h(s),o(!0)},className:"whitespace-nowrap",children:[e.jsx(Z,{size:16,className:"mr-1"}),"View"]}),!s.isApproved&&e.jsx(n,{variant:"success",size:"sm",onClick:()=>f(s._id,!0),className:"whitespace-nowrap",children:"Approve"}),s.isApproved&&e.jsx(n,{variant:"secondary",size:"sm",onClick:()=>f(s._id,!1),className:"whitespace-nowrap",children:"Reject"}),e.jsx(n,{variant:"danger",size:"sm",onClick:()=>P(s._id),className:"whitespace-nowrap",children:e.jsx(_,{size:16})})]})}];return w&&d.length===0?e.jsx(L,{}):e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reviews"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage product reviews and ratings"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(n,{variant:"secondary",onClick:()=>k(!R),className:"whitespace-nowrap",children:[e.jsx(Y,{size:18,className:"mr-2"}),"Filters"]})})]}),R&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Filters"}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(q,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product ID"}),e.jsx("input",{type:"text",value:l.productId,onChange:s=>{N({...l,productId:s.target.value}),p(1)},placeholder:"Enter product ID",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating"}),e.jsxs("select",{value:l.rating,onChange:s=>{N({...l,rating:s.target.value}),p(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Ratings"}),e.jsx("option",{value:"5",children:"5 Stars"}),e.jsx("option",{value:"4",children:"4 Stars"}),e.jsx("option",{value:"3",children:"3 Stars"}),e.jsx("option",{value:"2",children:"2 Stars"}),e.jsx("option",{value:"1",children:"1 Star"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:l.isApproved,onChange:s=>{N({...l,isApproved:s.target.value}),p(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Approved"}),e.jsx("option",{value:"false",children:"Pending"})]})]})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsx(K,{value:u,onChange:I,placeholder:"Search by user name, product name, product ID, or review content..."})}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:v}),w?e.jsx(L,{}):D.length===0?e.jsxs("div",{className:"bg-white p-12 rounded-lg border border-gray-200 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"No reviews found"}),d.length===0&&!v&&e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Try running the seed script: npm run seed:reviews"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-x-auto",children:e.jsx(H,{data:D,columns:X})}),e.jsx(J,{currentPage:g,totalPages:T,totalItems:O,itemsPerPage:A,onPageChange:p,align:"right"})]}),e.jsx(W,{isOpen:V,onClose:()=>{o(!1),h(null)},title:"Review Details",size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:a.user?.name||"Anonymous"}),e.jsx("div",{className:"text-sm text-gray-500",children:a.user?.email||"N/A"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[z(a.rating),e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:["(",a.rating,"/5)"]})]}),a.title&&e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:a.title}),e.jsx("p",{className:"text-gray-800",children:a.comment})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[a.product?.image&&e.jsx("img",{src:a.product.image,alt:a.product.name,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:a.product?.name||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Product ID: ",a.product?._id||"N/A"]})]})]}),a.images&&a.images.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Review Images"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:a.images.map((s,t)=>e.jsx("img",{src:s,alt:`Review image ${t+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200"},t))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Status:"}),a.isApproved?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:[e.jsx(E,{size:12}),"Approved"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium",children:[e.jsx(F,{size:12}),"Pending"]}),a.verifiedPurchase&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:"Verified Purchase"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Helpful: ",a.helpful||0]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-4 border-t border-gray-200",children:[!a.isApproved&&e.jsx(n,{variant:"success",onClick:()=>{f(a._id,!0),o(!1)},className:"whitespace-nowrap",children:"Approve Review"}),a.isApproved&&e.jsx(n,{variant:"secondary",onClick:()=>{f(a._id,!1)},className:"whitespace-nowrap",children:"Reject Review"}),e.jsxs(n,{variant:"danger",onClick:()=>{P(a._id),o(!1)},className:"whitespace-nowrap",children:[e.jsx(_,{size:16,className:"mr-1"}),"Delete Review"]})]})]})})]})};export{me as default};
