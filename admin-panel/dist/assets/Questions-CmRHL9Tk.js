import{r as i,G as J,N as y,z as c,j as e,L as E,s as d,X as K,O as W}from"./index-DrVHF49k.js";import{T as Z}from"./Table-CPTOpXxD.js";import{S as q}from"./SearchInput-DQh0A_yT.js";import{P as ee}from"./Pagination-hbdeIJ1d.js";import{M as se}from"./Modal-DV8JCKQd.js";import{F as te}from"./filter-DjuklAPT.js";import{T as I}from"./trash-2-C0lDSa_7.js";import{C as ae}from"./circle-check-big-wk8a-cBc.js";const ue=()=>{const[o,x]=i.useState([]),[v,A]=i.useState(!0),[j,w]=i.useState(null),[h,M]=i.useState(""),[g,S]=i.useState(1),[O,B]=i.useState(1),[R,C]=i.useState(0),D=10,[m,V]=i.useState({productId:""}),[L,Q]=i.useState(!1),[r,u]=i.useState(null),[U,b]=i.useState(!1),[f,p]=i.useState(""),[N,_]=i.useState(!1),{markQuestionsAsSeen:k,notificationItems:z,markAsRead:F}=J();i.useEffect(()=>{l(),k(),z.filter(s=>s.type==="question"&&!s.read).forEach(s=>F(s.id))},[g,m,k,z,F]),i.useEffect(()=>{let s,t=Date.now();const a=()=>{document.visibilityState==="visible"&&Date.now()-t>18e4&&(l(),t=Date.now())},n=()=>{document.visibilityState==="visible"&&(l(),t=Date.now())};return s=setInterval(a,18e4),document.addEventListener("visibilitychange",n),()=>{clearInterval(s),document.removeEventListener("visibilitychange",n)}},[g,m]);const l=async()=>{try{A(!0),w(null);const s={page:g,limit:D,...m};Object.keys(s).forEach(a=>{(s[a]===""||s[a]===null)&&delete s[a]});const t=await y.getAllQuestions(s);t.success?(x(t.data.questions||[]),B(t.data.pagination?.pages||1),C(t.data.pagination?.total||0)):w(t.message||"Failed to fetch questions")}catch(s){console.error("Error fetching questions:",s),w(s.response?.data?.message||"Failed to fetch questions"),c.error(s.response?.data?.message||"Failed to fetch questions")}finally{A(!1)}},G=async s=>{if(window.confirm("Are you sure you want to delete this question?"))try{await y.deleteQuestion(s),c.success("Question deleted successfully"),x(t=>t.filter(a=>a._id!==s)),C(t=>Math.max(0,t-1)),r?._id===s&&(b(!1),u(null))}catch(t){c.error(t.response?.data?.message||"Failed to delete question"),l()}},H=async(s,t)=>{if(window.confirm("Are you sure you want to delete this answer?"))try{await y.deleteAnswer(s,t),c.success("Answer deleted successfully"),r?._id===s&&u(a=>a&&{...a,answers:(a.answers||[]).filter(n=>n._id!==t)}),x(a=>a.map(n=>n._id===s?{...n,answers:(n.answers||[]).filter(P=>P._id!==t)}:n))}catch(a){c.error(a.response?.data?.message||"Failed to delete answer"),l()}},X=s=>{u(s),b(!0),p("")},Y=async()=>{if(!f.trim()||!r){c.error("Please enter an answer");return}try{_(!0);const s=await y.answerQuestion(r._id,f);if(c.success("Answer submitted successfully"),p(""),s.success&&s.data){const t=s.data.answers?.[s.data.answers.length-1];t?(u(a=>a&&{...a,answers:[...a.answers||[],t]}),x(a=>a.map(n=>n._id===r._id?{...n,answers:[...n.answers||[],t]}:n))):l()}else l()}catch(s){c.error(s.response?.data?.message||"Failed to submit answer"),l()}finally{_(!1)}},T=i.useMemo(()=>{if(!h)return o;const s=h.toLowerCase();return o.filter(t=>t.user?.name?.toLowerCase().includes(s)||t.product?.name?.toLowerCase().includes(s)||t.product?._id?.toLowerCase().includes(s)||t.product?._id?.slice(-8).toLowerCase().includes(s)||t.questionText?.toLowerCase().includes(s)||t.question?.toLowerCase().includes(s))},[o,h]),$=[{header:"Product",render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[s.product?.image&&e.jsx("img",{src:s.product.image,alt:s.product.name,className:"w-12 h-12 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.product?.name||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.product?._id?.slice(-8)||"N/A"]})]})]})},{header:"User",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.user?.name||"Anonymous"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.user?.email||"N/A"})]})},{header:"Question",render:s=>e.jsx("div",{className:"max-w-md",children:e.jsx("div",{className:"font-medium text-gray-900 line-clamp-2",children:s.questionText||s.question})})},{header:"Answers",render:s=>{const t=s.answers?.filter(a=>a.isActive!==!1)||[];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:[t.length," ",t.length===1?"Answer":"Answers"]}),t.some(a=>a.isAdmin)&&e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx(ae,{size:12}),"Admin"]})]})}},{header:"Date",render:s=>e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString()})},{header:"Actions",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"primary",size:"sm",onClick:()=>X(s),className:"whitespace-nowrap",children:[e.jsx(W,{size:16,className:"mr-1"}),"View"]}),e.jsx(d,{variant:"danger",size:"sm",onClick:()=>G(s._id),className:"whitespace-nowrap",children:e.jsx(I,{size:16})})]})}];return v&&o.length===0?e.jsx(E,{}):e.jsxs("div",{className:"space-y-6 max-w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Questions & Answers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage customer questions and answers"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(d,{variant:"secondary",onClick:()=>Q(!L),className:"whitespace-nowrap",children:[e.jsx(te,{size:18,className:"mr-2"}),"Filters"]})})]}),L&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Filters"}),e.jsx("button",{onClick:()=>Q(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(K,{size:20})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product ID"}),e.jsx("input",{type:"text",value:m.productId,onChange:s=>{V({...m,productId:s.target.value}),S(1)},placeholder:"Enter product ID",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsx(q,{value:h,onChange:M,placeholder:"Search by user name, product name, product ID, or question..."})}),j&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:j}),v?e.jsx(E,{}):T.length===0?e.jsxs("div",{className:"bg-white p-12 rounded-lg border border-gray-200 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"No questions found"}),o.length===0&&!j&&e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Try running the seed script: npm run seed:reviews"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx(Z,{data:T,columns:$})}),e.jsx(ee,{currentPage:g,totalPages:O,totalItems:R,itemsPerPage:D,onPageChange:S,align:"right"})]}),e.jsx(se,{isOpen:U,onClose:()=>{b(!1),u(null)},title:"Question Details",size:"lg",children:r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:r.user?.name||"Anonymous"}),e.jsx("div",{className:"text-sm text-gray-500",children:r.user?.email||"N/A"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(r.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-800 mt-2",children:r.question})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[r.product?.image&&e.jsx("img",{src:r.product.image,alt:r.product.name,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:r.product?.name||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Product ID: ",r.product?._id||"N/A"]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3",children:["Answers (",r.answers?.filter(s=>s.isActive!==!1).length||0,")"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:r.answers?.filter(s=>s.isActive!==!1).length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No answers yet"}):r.answers?.filter(s=>s.isActive!==!1).map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.isAdmin?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.answeredBy?.name||"Anonymous"}),s.isAdmin&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:"Admin"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-800 mb-2",children:s.answerText||s.answer}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Helpful: ",s.helpful||0]}),e.jsxs(d,{variant:"danger",size:"sm",onClick:()=>H(r._id,s._id),className:"whitespace-nowrap",children:[e.jsx(I,{size:14,className:"mr-1"}),"Delete"]})]})]},s._id))}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Add Your Answer ",e.jsx("span",{className:"text-blue-600",children:"(Admin Reply)"})]}),e.jsx("textarea",{value:f,onChange:s=>p(s.target.value),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent mb-3 resize-none",placeholder:"Type your answer here... (This will be marked as an admin reply)"}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(d,{variant:"secondary",size:"sm",onClick:()=>p(""),disabled:N,className:"whitespace-nowrap",children:"Clear"}),e.jsx(d,{variant:"primary",size:"sm",onClick:Y,disabled:!f.trim()||N,className:"whitespace-nowrap",children:N?"Submitting...":"Submit Answer"})]})]})]})]})})]})};export{ue as default};
